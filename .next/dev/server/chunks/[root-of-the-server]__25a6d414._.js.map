{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/project/app/api/itinerary/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport OpenAI from 'openai';\r\n\r\nconst openai = new OpenAI({\r\n    apiKey: process.env.OPENAI_API_KEY,\r\n});\r\n\r\nfunction generatePrompt(\r\n    destination: string,\r\n    days: number,\r\n    budget: number,\r\n    style: string,\r\n    hotel: string,\r\n    constraints?: {\r\n        budgetLevel: string;\r\n        distanceLimit: boolean;\r\n        walkingIntensity: string;\r\n    },\r\n    month?: string\r\n): string {\r\n    // Build smart constraints text\r\n    let smartRules = '';\r\n\r\n    if (constraints) {\r\n        if (constraints.budgetLevel === 'budget') {\r\n            smartRules += '\\n- BUDGET LOW: Prioritize FREE activities, local markets, and nature spots.';\r\n        } else if (constraints.budgetLevel === 'premium') {\r\n            smartRules += '\\n- PREMIUM MODE: Include luxury dining and exclusive experiences.';\r\n        }\r\n\r\n        if (constraints.distanceLimit) {\r\n            smartRules += '\\n- SHORT TRIP: Skip far places. Keep all locations central to save travel time.\\n- Max travel between spots: 20 mins.';\r\n        }\r\n\r\n        if (constraints.walkingIntensity === 'low') {\r\n            smartRules += '\\n- FAMILY MODE: Reduce walking usage. Suggest places with easy access and seating.\\n- Kid-friendly content.';\r\n        } else if (constraints.walkingIntensity === 'high') {\r\n            smartRules += '\\n- BACKPACKER MODE: High walking intensity allowed.';\r\n        }\r\n    }\r\n\r\n    return `\r\nYou are a professional travel planner.\r\n\r\nCreate a realistic ${days}-day itinerary for ${destination}.\r\nBudget: ₹${budget}\r\nTravel style: ${style}\r\nStarting location: ${hotel}\r\nTravel Month: ${month || 'Not specified'}\r\n\r\nRULES:\r\n- Max 4 places per day\r\n- Group nearby locations\r\n- Include food suggestions\r\n- Include travel time estimates\r\n- Make it practical for Indian travelers\r\n- Avoid unrealistic rushing\r\n- IMPORTANT: Include GPS coordinates (lat, lon) for each place (REQUIRED for map)\r\n- Optimize order by distance (nearest places first)\r\n${smartRules}\r\n\r\nROLE:\r\nYou are a local guide who knows the best times to visit.\r\n- Check if ${month} is a MONSOON month for ${destination}. If yes, WARN about rain.\r\n- Check if ${month} is PEAK season (crowds).\r\n- Check if any MAJOR FESTIVALS happen in ${month} in ${destination} (e.g. Diwali, Christmas, Cherry Blossoms).\r\n\r\nOUTPUT FORMAT (STRICT JSON):\r\n{\r\n  \"seasonal_warning\": {\r\n      \"title\": \"Warning Title (e.g. 'Monsoon Alert' or 'Diwali Festival') or null\",\r\n      \"description\": \"Short explanation of what to expect (rain, crowds, or events).\",\r\n      \"severity\": \"high\" | \"moderate\" | \"info\" | \"none\"\r\n  },\r\n  \"hotel_coordinates\": {\r\n    \"lat\": 28.6139,\r\n    \"lon\": 77.2090  \r\n  },\r\n  \"day_1\": {\r\n    \"places\": [\r\n      {\r\n        \"name\": \"Place Name\",\r\n        \"description\": \"Description\",\r\n        \"entry_fee\": \"Free or ₹amount\",\r\n        \"lat\": 28.6139,\r\n        \"lon\": 77.2090\r\n      }\r\n    ],\r\n    \"food\": [\r\n      {\r\n        \"name\": \"Restaurant Name\",\r\n        \"description\": \"Description\"\r\n      }\r\n    ],\r\n    \"travel_time\": \"Total time for day\",\r\n    \"notes\": \"Tips and suggestions\"\r\n  }\r\n}\r\n`;\r\n}\r\n\r\nexport async function POST(req: Request) {\r\n    try {\r\n        const body = await req.json();\r\n        const { destination, days, budget, style, hotel, constraints, month } = body;\r\n\r\n        // Validate required fields\r\n        if (!destination || !days || !budget || !style || !hotel) {\r\n            return NextResponse.json(\r\n                { error: 'Missing required fields: destination, days, budget, style, hotel' },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        // Validate days is a positive number\r\n        if (typeof days !== 'number' || days <= 0 || days > 30) {\r\n            return NextResponse.json(\r\n                { error: 'Days must be a number between 1 and 30' },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        // Validate OpenAI API key\r\n        if (!process.env.OPENAI_API_KEY) {\r\n            console.error('OPENAI_API_KEY is not configured');\r\n            return NextResponse.json(\r\n                { error: 'OpenAI API key not configured. Please set OPENAI_API_KEY in environment variables.' },\r\n                { status: 500 }\r\n            );\r\n        }\r\n\r\n        const prompt = generatePrompt(destination, days, budget, style, hotel, constraints, month);\r\n\r\n        const response = await openai.chat.completions.create({\r\n            model: 'gpt-4o-mini',\r\n            messages: [{ role: 'user', content: prompt }],\r\n            temperature: 0.7,\r\n        });\r\n\r\n        return NextResponse.json({\r\n            itinerary: response.choices[0].message.content,\r\n        });\r\n    } catch (error) {\r\n        console.error('OpenAI API Error:', error);\r\n\r\n        // Handle specific OpenAI errors\r\n        if (error instanceof Error) {\r\n            if (error.message.includes('API key')) {\r\n                return NextResponse.json(\r\n                    { error: 'Invalid OpenAI API key' },\r\n                    { status: 401 }\r\n                );\r\n            }\r\n            if (error.message.includes('quota')) {\r\n                return NextResponse.json(\r\n                    { error: 'OpenAI API quota exceeded' },\r\n                    { status: 429 }\r\n                );\r\n            }\r\n        }\r\n\r\n        return NextResponse.json(\r\n            { error: 'Failed to generate itinerary. Please try again.' },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}